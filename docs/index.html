<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multisource Embeddings for Medical Records • memr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Multisource Embeddings for Medical Records">
<meta property="og:description" content="Generates embeddings of terms extracted from medical visits.
    Generates embeddings of visits. Makes clustering of visits and
    visualization.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">memr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="memr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#memr" class="anchor"></a>memr</h1></div>
<div id="medical-records-embeddings" class="section level2">
<h2 class="hasAnchor">
<a href="#medical-records-embeddings" class="anchor"></a>Medical records embeddings</h2>
<p>The <code>memr</code>(Multisource Embeddings for Medical Records) package in R allows for creating embeddings, i.e. vector representations, of medical free-text records written by doctors. It also provides a wide spectrum of tools to data visualization and medical visits’ segmentation. These tools aim to develop computer-supported medicine by facilitating medical data analysis and iterpretation. The package can be exploited for many applications like the recommendation prediction, patients’ clustering etc. that can aid doctors in their practice.</p>
</div>
<div id="installation-dependences" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-dependences" class="anchor"></a>Installation &amp; Dependences</h2>
<p><code>memr</code> is written in R and is based on the following packages:</p>
<ul>
<li>dplyr</li>
<li>ggplot2</li>
<li>ggrepel</li>
<li>Rtsne</li>
<li>text2vec</li>
</ul>
<p>To install <code>memr</code>, simply type in an R console (after having installed the <code>devtools</code> package, e.g. <code>install.package('devtools')</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_git</a></span>(<span class="st">"https://github.com/adamgdobrakowski/memr"</span>)</code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<div id="example-datasets" class="section level3">
<h3 class="hasAnchor">
<a href="#example-datasets" class="anchor"></a>Example datasets</h3>
<p>We show the usage of the package on the example datasets. They are completely artificial, but their structure reflects a structure of the real data collected from Polish health centers. The results of the research on the real data are described in the paper Dobrakowski et al. (2019).</p>
<p>For every visit we can have some information about ICD-10 code of diagnosed disease, ID and specialty of the doctor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(visits)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">visit_id</th>
<th align="left">icd10</th>
<th align="left">doctor_id</th>
<th align="left">specialties</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">101</td>
<td align="left">J32</td>
<td align="left">24</td>
<td align="left">endocrinologist, internist</td>
</tr>
<tr class="even">
<td align="left">102</td>
<td align="left">Y52</td>
<td align="left">26</td>
<td align="left">endocrinologist</td>
</tr>
<tr class="odd">
<td align="left">103</td>
<td align="left">X12</td>
<td align="left">24</td>
<td align="left">endocrinologist, internist</td>
</tr>
<tr class="even">
<td align="left">104</td>
<td align="left">Q29</td>
<td align="left">24</td>
<td align="left">endocrinologist, internist</td>
</tr>
<tr class="odd">
<td align="left">105</td>
<td align="left">U46</td>
<td align="left">26</td>
<td align="left">endocrinologist</td>
</tr>
<tr class="even">
<td align="left">106</td>
<td align="left">U50</td>
<td align="left">26</td>
<td align="left">endocrinologist</td>
</tr>
<tr class="odd">
<td align="left">107</td>
<td align="left">I58</td>
<td align="left">25</td>
<td align="left">cardiologist, internist</td>
</tr>
<tr class="even">
<td align="left">108</td>
<td align="left">C82</td>
<td align="left">26</td>
<td align="left">endocrinologist</td>
</tr>
<tr class="odd">
<td align="left">109</td>
<td align="left">P73</td>
<td align="left">24</td>
<td align="left">endocrinologist, internist</td>
</tr>
<tr class="even">
<td align="left">110</td>
<td align="left">P66</td>
<td align="left">26</td>
<td align="left">endocrinologist</td>
</tr>
<tr class="odd">
<td align="left">111</td>
<td align="left">U53</td>
<td align="left">23</td>
<td align="left">ophthalmologist, endocrinologist</td>
</tr>
</tbody>
</table>
<p>For the visits we have also the descriptions of interview with the extracted medical terms:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(interviews)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>101</td>
<td align="left">fever, eye</td>
</tr>
<tr class="even">
<td>102</td>
<td align="left">cough, thyroid</td>
</tr>
<tr class="odd">
<td>103</td>
<td align="left">fever, thyroid</td>
</tr>
<tr class="even">
<td>104</td>
<td align="left">fever, eye</td>
</tr>
<tr class="odd">
<td>105</td>
<td align="left">cough, thyroid</td>
</tr>
<tr class="even">
<td>106</td>
<td align="left">cough, thyroid</td>
</tr>
<tr class="odd">
<td>107</td>
<td align="left">cough, thyroid</td>
</tr>
<tr class="even">
<td>108</td>
<td align="left">rhinitis, eye</td>
</tr>
<tr class="odd">
<td>109</td>
<td align="left">rhinitis, eye</td>
</tr>
<tr class="even">
<td>110</td>
<td align="left">rhinitis, thyroid</td>
</tr>
</tbody>
</table>
<p>Descriptions of examinations of patients:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(examinations)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>102</td>
<td align="left">mother, father, cough, eye</td>
</tr>
<tr class="even">
<td>103</td>
<td align="left">woman, father, rhinitis, thyroid</td>
</tr>
<tr class="odd">
<td>104</td>
<td align="left">woman, father, fever, thyroid</td>
</tr>
<tr class="even">
<td>105</td>
<td align="left">mother, patient, rhinitis, eye</td>
</tr>
<tr class="odd">
<td>106</td>
<td align="left">man, father, cough, heart</td>
</tr>
<tr class="even">
<td>107</td>
<td align="left">woman, father, fever, eye</td>
</tr>
<tr class="odd">
<td>108</td>
<td align="left">woman, patient, rhinitis, thyroid</td>
</tr>
<tr class="even">
<td>109</td>
<td align="left">woman, patient, rhinitis, heart</td>
</tr>
<tr class="odd">
<td>110</td>
<td align="left">woman, father, cough, heart</td>
</tr>
<tr class="even">
<td>111</td>
<td align="left">man, father, rhinitis, eye</td>
</tr>
</tbody>
</table>
<p>And descriptions of recommendations prescribed by doctors to the patients:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(recommendations)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>103</td>
<td align="left">hospital, endocrinologist</td>
</tr>
<tr class="even">
<td>104</td>
<td align="left">hospital, sleep, internist</td>
</tr>
<tr class="odd">
<td>105</td>
<td align="left">hospital, internist</td>
</tr>
<tr class="even">
<td>106</td>
<td align="left">sleep, ophthalmologist</td>
</tr>
<tr class="odd">
<td>107</td>
<td align="left">hospital, treatment, ophthalmologist</td>
</tr>
<tr class="even">
<td>108</td>
<td align="left">treatment, ophthalmologist</td>
</tr>
<tr class="odd">
<td>109</td>
<td align="left">treatment, hospital, endocrinologist</td>
</tr>
<tr class="even">
<td>110</td>
<td align="left">hospital, sleep, cardiologist</td>
</tr>
</tbody>
</table>
<p>Each medical term has one or more categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(terms_categories)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">term</th>
<th align="left">category</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">man</td>
<td align="left">person</td>
</tr>
<tr class="even">
<td align="left">woman</td>
<td align="left">person</td>
</tr>
<tr class="odd">
<td align="left">mother</td>
<td align="left">person</td>
</tr>
<tr class="even">
<td align="left">father</td>
<td align="left">person</td>
</tr>
<tr class="odd">
<td align="left">patient</td>
<td align="left">person</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="left">disease</td>
</tr>
<tr class="odd">
<td align="left">rhinitis</td>
<td align="left">disease</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="left">disease</td>
</tr>
<tr class="odd">
<td align="left">sleep</td>
<td align="left">recommendation</td>
</tr>
<tr class="even">
<td align="left">healthy eating</td>
<td align="left">recommendation</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="left">recommendation</td>
</tr>
<tr class="even">
<td align="left">treatment</td>
<td align="left">recommendation</td>
</tr>
<tr class="odd">
<td align="left">internist</td>
<td align="left">specialty</td>
</tr>
<tr class="even">
<td align="left">cardiologist</td>
<td align="left">specialty</td>
</tr>
<tr class="odd">
<td align="left">ophthalmologist</td>
<td align="left">specialty</td>
</tr>
<tr class="even">
<td align="left">endocrinologist</td>
<td align="left">specialty</td>
</tr>
<tr class="odd">
<td align="left">heart</td>
<td align="left">anatomic</td>
</tr>
<tr class="even">
<td align="left">eye</td>
<td align="left">anatomic</td>
</tr>
<tr class="odd">
<td align="left">thyroid</td>
<td align="left">anatomic</td>
</tr>
</tbody>
</table>
</div>
<div id="medical-terms-embeddings" class="section level3">
<h3 class="hasAnchor">
<a href="#medical-terms-embeddings" class="anchor"></a>Medical terms embeddings</h3>
<p>Firstly we can compute embeddings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">embedding_size &lt;-<span class="st"> </span><span class="dv">3</span>

interview_term_vectors &lt;-<span class="st"> </span><span class="kw"><a href="reference/embed_terms.html">embed_terms</a></span>(<span class="dt">merged_terms =</span> interviews, <span class="dt">embedding_size =</span> embedding_size,
                                       <span class="dt">term_count_min =</span> 1L)
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 1, expected cost 0.1679</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 2, expected cost 0.1195</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 3, expected cost 0.0929</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 4, expected cost 0.0753</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 5, expected cost 0.0627</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 6, expected cost 0.0532</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 7, expected cost 0.0458</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 8, expected cost 0.0398</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 9, expected cost 0.0350</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 10, expected cost 0.0309</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 11, expected cost 0.0275</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 12, expected cost 0.0246</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 13, expected cost 0.0221</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 14, expected cost 0.0199</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 15, expected cost 0.0179</span>
examination_term_vectors &lt;-<span class="st"> </span><span class="kw"><a href="reference/embed_terms.html">embed_terms</a></span>(<span class="dt">merged_terms =</span> examinations, <span class="dt">embedding_size =</span> embedding_size,
                                         <span class="dt">term_count_min =</span> 1L)
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 1, expected cost 0.0596</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 2, expected cost 0.0338</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 3, expected cost 0.0242</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 4, expected cost 0.0194</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 5, expected cost 0.0165</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 6, expected cost 0.0147</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 7, expected cost 0.0133</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 8, expected cost 0.0123</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 9, expected cost 0.0115</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 10, expected cost 0.0108</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 11, expected cost 0.0102</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 12, expected cost 0.0097</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 13, expected cost 0.0093</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 14, expected cost 0.0089</span>
<span class="co">#&gt; INFO [2020-02-08 11:32:48] 2020-02-08 11:32:48 - epoch 15, expected cost 0.0086</span>

knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(interview_term_vectors[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ])</code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">rhinitis</td>
<td align="right">-0.4591842</td>
<td align="right">0.0773042</td>
<td align="right">0.3169519</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">-0.3166999</td>
<td align="right">0.4445915</td>
<td align="right">0.2889484</td>
</tr>
<tr class="odd">
<td align="left">eye</td>
<td align="right">0.6172635</td>
<td align="right">-0.0026380</td>
<td align="right">-0.2859116</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">-0.3053243</td>
<td align="right">0.1688631</td>
<td align="right">0.6479924</td>
</tr>
<tr class="odd">
<td align="left">thyroid</td>
<td align="right">-0.2251053</td>
<td align="right">-0.4781070</td>
<td align="right">-0.1793006</td>
</tr>
</tbody></table>
<p>Terms from the chosen category can be visualized:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_term_embeddings.html">visualize_term_embeddings</a></span>(terms_categories, interview_term_vectors, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"anatomic"</span>), <span class="dt">method =</span> <span class="st">"PCA"</span>)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png"></p>
<p>To validate the quality of embeddings we can perform the term analogy task (see more by ?analogy_task). The package delivers the analogy test set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="reference/evaluate_term_embeddings.html">evaluate_term_embeddings</a></span>(examination_term_vectors, <span class="dt">n =</span> <span class="dv">5</span>, terms_pairs_test))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">MEAN</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>person</td>
<td align="right">0</td>
<td align="right">0.5000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.7000000</td>
</tr>
<tr class="even">
<td>spec</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>synonym</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td>MEAN</td>
<td align="right">0</td>
<td align="right">0.1666667</td>
<td align="right">0.3333333</td>
<td align="right">0.3333333</td>
<td align="right">0.3333333</td>
<td align="right">0.2333333</td>
</tr>
</tbody>
</table>
<p>For each type of analogy we compute the mean accuracy.</p>
<p>Analogies can be plotted to see if the connection lines are parallel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_analogies.html">visualize_analogies</a></span>(examination_term_vectors, terms_pairs_test<span class="op">$</span>person, <span class="dt">find_analogies =</span> <span class="ot">TRUE</span>, <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png"></p>
</div>
<div id="visits-embeddings" class="section level3">
<h3 class="hasAnchor">
<a href="#visits-embeddings" class="anchor"></a>Visits embeddings</h3>
<p>Having the embeddings of terms, we can compute embeddings of visits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visits_vectors &lt;-<span class="st"> </span><span class="kw"><a href="reference/embed_list_visits.html">embed_list_visits</a></span>(interviews, examinations, interview_term_vectors, examination_term_vectors)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(visits_vectors[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ])</code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">101</td>
<td align="right">0.1502818</td>
<td align="right">0.2209768</td>
<td align="right">0.0015184</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">102</td>
<td align="right">-0.2652148</td>
<td align="right">-0.1546220</td>
<td align="right">0.2343459</td>
<td align="right">0.0315736</td>
<td align="right">-0.1512805</td>
<td align="right">-0.0030038</td>
</tr>
<tr class="odd">
<td align="left">103</td>
<td align="right">-0.2709026</td>
<td align="right">-0.0167577</td>
<td align="right">0.0548239</td>
<td align="right">-0.0211255</td>
<td align="right">0.0591052</td>
<td align="right">0.0587511</td>
</tr>
<tr class="even">
<td align="left">104</td>
<td align="right">0.1502818</td>
<td align="right">0.2209768</td>
<td align="right">0.0015184</td>
<td align="right">0.0436967</td>
<td align="right">0.0468291</td>
<td align="right">-0.0488440</td>
</tr>
<tr class="odd">
<td align="left">105</td>
<td align="right">-0.2652148</td>
<td align="right">-0.1546220</td>
<td align="right">0.2343459</td>
<td align="right">-0.0186915</td>
<td align="right">-0.1348312</td>
<td align="right">0.0672795</td>
</tr>
</tbody></table>
<p>And now we can visualize the visits on the plot and color by the doctors’ IDs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits, <span class="dt">color_by =</span> <span class="st">"doctor"</span>,
                                <span class="dt">spec =</span> <span class="st">"internist"</span>)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png"></p>
<p>or by ICD-10 code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits, <span class="dt">color_by =</span> <span class="st">"icd10"</span>,
                                <span class="dt">spec =</span> <span class="st">"internist"</span>)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png"></p>
</div>
<div id="clustering" class="section level3">
<h3 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h3>
<p>On the visits’ embeddings we can run the k-means algorithm:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusters &lt;-<span class="st"> </span><span class="kw"><a href="reference/cluster_visits.html">cluster_visits</a></span>(visits_vectors, visits, <span class="dt">spec =</span> <span class="st">"internist"</span>, <span class="dt">cluster_number =</span> <span class="dv">2</span>)</code></pre></div>
<p>and plot the clusters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits, <span class="dt">color_by =</span> <span class="st">"cluster"</span>,
                                <span class="dt">spec =</span> <span class="st">"internist"</span>, <span class="dt">clusters =</span> clusters)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-16-1.png"></p>
<p>For every cluster we can see the most frequent recommendations from chosen categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rec_tables &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_cluster_recommendations.html">get_cluster_recommendations</a></span>(recommendations, clusters,
                                          <span class="dt">category =</span> <span class="st">"recommendation"</span>,
                                          <span class="dt">recom_table =</span> terms_categories)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(rec_tables)</code></pre></div>
<table class="table kable_wrapper"><tbody><tr>
<td>
| recommendation |  count|  frequency|
|:---------------|------:|----------:|
| hospital       |      2|  0.6666667|
| sleep          |      1|  0.3333333|
| treatment      |      1|  0.3333333|

</td>
<td>
| recommendation |  count|  frequency|
|:---------------|------:|----------:|
| hospital       |      2|        1.0|
| treatment      |      1|        0.5|

</td>
</tr></tbody></table>
<p>or from all categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rec_tables &lt;-<span class="st"> </span><span class="kw"><a href="reference/get_cluster_recommendations.html">get_cluster_recommendations</a></span>(recommendations, clusters, <span class="dt">category =</span> <span class="st">"all"</span>)
rec_tables
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 5 x 3</span>
<span class="co">#&gt;   recommendation  count frequency</span>
<span class="co">#&gt;   &lt;fct&gt;           &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 hospital            2     0.667</span>
<span class="co">#&gt; 2 endocrinologist     1     0.333</span>
<span class="co">#&gt; 3 internist           1     0.333</span>
<span class="co">#&gt; 4 sleep               1     0.333</span>
<span class="co">#&gt; 5 treatment           1     0.333</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   recommendation  count frequency</span>
<span class="co">#&gt;   &lt;fct&gt;           &lt;int&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 hospital            2       1  </span>
<span class="co">#&gt; 2 endocrinologist     1       0.5</span>
<span class="co">#&gt; 3 ophthalmologist     1       0.5</span>
<span class="co">#&gt; 4 treatment           1       0.5</span></code></pre></div>
<p>If we have a new visit, we can assign it to the most appropriate cluster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inter_descr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"cough"</span>, <span class="dt">sep =</span> <span class="st">", "</span>)
exam_descr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"fever"</span>, <span class="dt">sep =</span> <span class="st">", "</span>)
visit_description &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(inter_descr, exam_descr)
<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(visit_description) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"inter"</span>, <span class="st">"exam"</span>)
cl &lt;-<span class="st"> </span><span class="kw"><a href="reference/assign_visit_to_cluster.html">assign_visit_to_cluster</a></span>(visit_description, clusters, interview_term_vectors, examination_term_vectors)
cl
<span class="co">#&gt; $cl</span>
<span class="co">#&gt; 2 </span>
<span class="co">#&gt; 2 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $distances</span>
<span class="co">#&gt;         1         2 </span>
<span class="co">#&gt; 0.1641233 0.1238790</span></code></pre></div>
<p>As the last nice thing we can see the embeddings of ICD-10 codes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="reference/visualize_icd10.html">visualize_icd10</a></span>(visits_vectors, visits)</code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-20-1.png"></p>
</div>
</div>
</div>
<div id="acknowledgements" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h1>
<p>The package was created during the research financially supported by the Polish Centre for Research and Development (Grant POIR.01.01.01-00-0328/17).</p>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Dobrakowski, Adam, Agnieszka Mykowiecka, Małgorzata Marciniak, Wojciech Jaworski, and Przemysław Biecek. 2019. “Interpretable Segmentation of Medical Free-Text Records Based on Word Embeddings.” <em>arXiv Preprint arXiv:1907.04152</em>.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Adam Gabriel Dobrakowski <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Adam Gabriel Dobrakowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
