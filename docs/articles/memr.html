<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quick start to memr • memr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quick start to memr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">memr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/memr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Quick start to memr</h1>
                        <h4 class="author">Adam G. Dobrakowski</h4>
            
      
      
      <div class="hidden name"><code>memr.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(memr)</code></pre></div>
<div id="medical-records-embeddings" class="section level2">
<h2 class="hasAnchor">
<a href="#medical-records-embeddings" class="anchor"></a>Medical records embeddings</h2>
<p>Most of information about medical visits is often stored in an unstructured way as a free text written by doctors. This package allows for creating embeddings of medical records, convenient to a wide spectrum of tasks, like visualization of records, clustering etc.</p>
</div>
<div id="example-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#example-datasets" class="anchor"></a>Example datasets</h2>
<p>The package provides a data with about 1000 visits from Polish health centers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(visits_<span class="dv">1000</span>[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">visit_id</th>
<th align="left">icd10</th>
<th align="right">doctor_id</th>
<th align="left">specialties</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">624368</td>
<td align="left">O26</td>
<td align="right">82</td>
<td align="left">ginekologia</td>
</tr>
<tr class="even">
<td align="right">885869</td>
<td align="left">J02</td>
<td align="right">245</td>
<td align="left">medycyna rodzinna</td>
</tr>
<tr class="odd">
<td align="right">885974</td>
<td align="left">Z30</td>
<td align="right">82</td>
<td align="left">ginekologia</td>
</tr>
<tr class="even">
<td align="right">886636</td>
<td align="left">N76</td>
<td align="right">239</td>
<td align="left">ginekologia</td>
</tr>
<tr class="odd">
<td align="right">1055522</td>
<td align="left">J20</td>
<td align="right">157</td>
<td align="left">medycyna rodzinna, pediatria</td>
</tr>
<tr class="even">
<td align="right">1056745</td>
<td align="left">N81</td>
<td align="right">6</td>
<td align="left">ginekologia</td>
</tr>
<tr class="odd">
<td align="right">1057217</td>
<td align="left">M51</td>
<td align="right">255</td>
<td align="left">medycyna rodzinna</td>
</tr>
<tr class="even">
<td align="right">1214269</td>
<td align="left">J04</td>
<td align="right">255</td>
<td align="left">medycyna rodzinna</td>
</tr>
<tr class="odd">
<td align="right">1318257</td>
<td align="left">B02</td>
<td align="right">255</td>
<td align="left">medycyna rodzinna</td>
</tr>
<tr class="even">
<td align="right">1318506</td>
<td align="left">O26</td>
<td align="right">82</td>
<td align="left">ginekologia</td>
</tr>
</tbody>
</table>
<p>For the visits we have the descriptions of interview, with the extracted medical terms and their categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(interview_<span class="dv">1000</span>[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">x</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">8834656</td>
</tr></tbody>
</table>
</td>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">lemma</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">ból</td>
<td align="left">obj</td>
</tr>
<tr class="even">
<td align="left">temperatura ciała</td>
<td align="left">fiz</td>
</tr>
<tr class="odd">
<td align="left">temperatura ciała</td>
<td align="left">typ</td>
</tr>
<tr class="even">
<td align="left">tempo</td>
<td align="left">fiz</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</td>
<td>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">x</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">8040952</td>
</tr></tbody>
</table>
</td>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">lemma</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bark</td>
<td align="left">anat</td>
</tr>
<tr class="even">
<td align="left">ciśnienie</td>
<td align="left">fiz</td>
</tr>
<tr class="odd">
<td align="left">nadgarstek</td>
<td align="left">anat</td>
</tr>
<tr class="even">
<td align="left">nasilenie dolegliwości</td>
<td align="left">zmcz_obj</td>
</tr>
<tr class="odd">
<td align="left">poziom</td>
<td align="left">cecha</td>
</tr>
<tr class="even">
<td align="left">staw ręki</td>
<td align="left">anat</td>
</tr>
<tr class="odd">
<td align="left">nic</td>
<td align="left">NEG</td>
</tr>
<tr class="even">
<td align="left">ujemny</td>
<td align="left">wCechy</td>
</tr>
<tr class="odd">
<td align="left">sód</td>
<td align="left">NEW</td>
</tr>
<tr class="even">
<td align="left">sód</td>
<td align="left">chm</td>
</tr>
<tr class="odd">
<td align="left">tętno</td>
<td align="left">fiz</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</td>
<td>
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">x</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">1898742</td>
</tr></tbody>
</table>
</td>
<td>
<table class="table">
<thead><tr class="header">
<th align="left">lemma</th>
<th align="left">type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">apetyt</td>
<td align="left">obj</td>
</tr>
<tr class="even">
<td align="left">duży</td>
<td align="left">cecha</td>
</tr>
<tr class="odd">
<td align="left">lek</td>
<td align="left">lk</td>
</tr>
<tr class="even">
<td align="left">lękowy</td>
<td align="left">cecha</td>
</tr>
<tr class="odd">
<td align="left">niewydolność</td>
<td align="left">obj</td>
</tr>
<tr class="even">
<td align="left">pamięć</td>
<td align="left">fiz</td>
</tr>
<tr class="odd">
<td align="left">poczucie</td>
<td align="left">czynnik</td>
</tr>
<tr class="even">
<td align="left">poprawa stanu psychicznego</td>
<td align="left">zmcz_stan</td>
</tr>
<tr class="odd">
<td align="left">skarga</td>
<td align="left">dok</td>
</tr>
<tr class="even">
<td align="left">słaby</td>
<td align="left">cecha</td>
</tr>
<tr class="odd">
<td align="left">w ciągu dnia</td>
<td align="left">czas</td>
</tr>
<tr class="even">
<td align="left">nic</td>
<td align="left">NEG</td>
</tr>
<tr class="odd">
<td align="left">ujemny</td>
<td align="left">wCechy</td>
</tr>
<tr class="even">
<td align="left">prawe oko</td>
<td align="left">anat</td>
</tr>
<tr class="odd">
<td align="left">prawe oko</td>
<td align="left">anat-frag</td>
</tr>
<tr class="even">
<td align="left">prawe oko</td>
<td align="left">cecha-ilość</td>
</tr>
<tr class="odd">
<td align="left">prawe oko</td>
<td align="left">jedn</td>
</tr>
<tr class="even">
<td align="left">sód</td>
<td align="left">NEW</td>
</tr>
<tr class="odd">
<td align="left">sód</td>
<td align="left">chm</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</td>
</tr></tbody></table>
<p>In the same form we have the descriptions of examinations and recommendations.</p>
</div>
<div id="medical-terms-embeddings" class="section level2">
<h2 class="hasAnchor">
<a href="#medical-terms-embeddings" class="anchor"></a>Medical terms embeddings</h2>
<p>Firstly we can find all medical terms and transform the descriptions into more convenient form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inter &lt;-<span class="st"> </span><span class="kw"><a href="../reference/parse_data.html">parse_data</a></span>(interview_<span class="dv">1000</span>)
exam &lt;-<span class="st"> </span><span class="kw"><a href="../reference/parse_data.html">parse_data</a></span>(examination_<span class="dv">1000</span>)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(inter[[<span class="dv">1</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">term</th>
<th align="left">category</th>
<th align="right">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">achilles</td>
<td align="left">anat</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">acidum</td>
<td align="left">anat</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">acidum</td>
<td align="left">cecha</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">acidum</td>
<td align="left">chm</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">aktualny</td>
<td align="left">cecha</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">aktywność</td>
<td align="left">proc</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">aktywność fizyczna</td>
<td align="left">proc</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">aktywność sportowa</td>
<td align="left">proc</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">aktywny</td>
<td align="left">cecha</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">alergia</td>
<td align="left">chr</td>
<td align="right">14</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(inter[[<span class="dv">2</span>]][<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="left">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>8834656</td>
<td align="left">ból, temperatura ciała, tempo</td>
</tr>
<tr class="even">
<td>8040952</td>
<td align="left">bark, ciśnienie, nadgarstek, nasilenie dolegliwości, nic, poziom, sód, staw ręki, tętno, ujemny</td>
</tr>
<tr class="odd">
<td>1898742</td>
<td align="left">apetyt, duży, lek, lękowy, nic, niewydolność, pamięć, poczucie, poprawa stanu psychicznego, prawe oko, skarga, słaby, sód, ujemny, w ciągu dnia</td>
</tr>
</tbody>
</table>
<p>Now, we can compute embeddings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inter_descriptions &lt;-<span class="st"> </span>inter[[<span class="dv">2</span>]]
exam_descriptions &lt;-<span class="st"> </span>exam[[<span class="dv">2</span>]]

embedding_size &lt;-<span class="st"> </span><span class="dv">8</span>

inter_term_vectors &lt;-<span class="st"> </span><span class="kw"><a href="../reference/embed_terms.html">embed_terms</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(inter[[<span class="dv">1</span>]]<span class="op">$</span>term), inter_descriptions, <span class="dt">embedding_size =</span> embedding_size)
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 1, expected cost 0.0894</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 2, expected cost 0.0497</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 3, expected cost 0.0413</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 4, expected cost 0.0371</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 5, expected cost 0.0345</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 6, expected cost 0.0327</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 7, expected cost 0.0313</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 8, expected cost 0.0303</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 9, expected cost 0.0294</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 10, expected cost 0.0287</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 11, expected cost 0.0280</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 12, expected cost 0.0275</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 13, expected cost 0.0271</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 14, expected cost 0.0267</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 15, expected cost 0.0263</span>
exam_term_vectors &lt;-<span class="st"> </span><span class="kw"><a href="../reference/embed_terms.html">embed_terms</a></span>(exam[[<span class="dv">1</span>]]<span class="op">$</span>term, exam_descriptions, <span class="dt">embedding_size =</span> embedding_size)
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 1, expected cost 0.1466</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 2, expected cost 0.0734</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 3, expected cost 0.0548</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 4, expected cost 0.0465</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 5, expected cost 0.0420</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 6, expected cost 0.0392</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 7, expected cost 0.0373</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 8, expected cost 0.0359</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 9, expected cost 0.0348</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 10, expected cost 0.0339</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 11, expected cost 0.0332</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 12, expected cost 0.0326</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 13, expected cost 0.0321</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 14, expected cost 0.0317</span>
<span class="co">#&gt; INFO [2019-12-13 11:04:57] 2019-12-13 11:04:57 - epoch 15, expected cost 0.0313</span>

knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(inter_term_vectors[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ])</code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">jajnik</td>
<td align="right">-0.5250897</td>
<td align="right">-0.2260535</td>
<td align="right">-0.0966656</td>
<td align="right">0.3418502</td>
<td align="right">0.1102451</td>
<td align="right">-0.4967396</td>
<td align="right">-0.1454571</td>
<td align="right">0.0878155</td>
</tr>
<tr class="even">
<td align="left">powód wizyty ginekologicznej</td>
<td align="right">-0.7332904</td>
<td align="right">-0.9079077</td>
<td align="right">-0.1060645</td>
<td align="right">-0.4317912</td>
<td align="right">0.4032139</td>
<td align="right">0.3417570</td>
<td align="right">0.4434612</td>
<td align="right">-0.3368444</td>
</tr>
<tr class="odd">
<td align="left">nieregularny</td>
<td align="right">-0.0592726</td>
<td align="right">-0.8252704</td>
<td align="right">-0.2889622</td>
<td align="right">-0.0461139</td>
<td align="right">0.3152012</td>
<td align="right">-0.2957996</td>
<td align="right">0.1824914</td>
<td align="right">0.0567866</td>
</tr>
<tr class="even">
<td align="left">kolonoskopia</td>
<td align="right">-0.0696577</td>
<td align="right">-0.3318594</td>
<td align="right">-0.2129605</td>
<td align="right">-0.2282260</td>
<td align="right">0.6195326</td>
<td align="right">0.2759004</td>
<td align="right">-0.0375025</td>
<td align="right">0.1102348</td>
</tr>
<tr class="odd">
<td align="left">obniżenie</td>
<td align="right">-0.1588032</td>
<td align="right">-0.0964152</td>
<td align="right">-0.7035043</td>
<td align="right">-0.3088086</td>
<td align="right">0.0200333</td>
<td align="right">-0.3260307</td>
<td align="right">-0.3287571</td>
<td align="right">-0.1042769</td>
</tr>
</tbody></table>
<p>Terms from the chosen category can be visualized:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_term_embeddings.html">visualize_term_embeddings</a></span>(inter[[<span class="dv">1</span>]], inter_term_vectors, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"spec"</span>), <span class="dt">method =</span> <span class="st">"PCA"</span>)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-6-1.png" width="720"></p>
<p>To validate the quality of embeddings we can perform the term analogy task (see more by ?analogy_task). The package delivers the analogy test set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="kw"><a href="../reference/evaluate_term_embeddings.html">evaluate_term_embeddings</a></span>(inter_term_vectors, <span class="dt">n =</span> <span class="dv">5</span>, terms_pairs_test))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">1</th>
<th align="right">2</th>
<th align="right">3</th>
<th align="right">4</th>
<th align="right">5</th>
<th align="right">MEAN</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>pain</td>
<td align="right">0.0000</td>
<td align="right">0.0500000</td>
<td align="right">0.1000000</td>
<td align="right">0.1000000</td>
<td align="right">0.1000000</td>
<td align="right">0.0700000</td>
</tr>
<tr class="even">
<td>adj</td>
<td align="right">0.0000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>right</td>
<td align="right">0.5000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
<td align="right">0.9000000</td>
</tr>
<tr class="even">
<td>left</td>
<td align="right">0.0000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>consult</td>
<td align="right">0.0000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td>anatomic</td>
<td align="right">0.0000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>man_woman</td>
<td align="right">0.0000</td>
<td align="right">0.1666667</td>
<td align="right">0.3333333</td>
<td align="right">0.3333333</td>
<td align="right">0.3333333</td>
<td align="right">0.2333333</td>
</tr>
<tr class="even">
<td>synonym</td>
<td align="right">0.0000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td>MEAN</td>
<td align="right">0.0625</td>
<td align="right">0.1520833</td>
<td align="right">0.1791667</td>
<td align="right">0.1791667</td>
<td align="right">0.1791667</td>
<td align="right">0.1504167</td>
</tr>
</tbody>
</table>
<p>For each type of analogy we compute the mean accuracy.</p>
<p>Analogies can be plotted to see if the connection lines are parallel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_analogies.html">visualize_analogies</a></span>(inter_term_vectors, terms_pairs_test<span class="op">$</span>man_woman, <span class="dt">find_analogies =</span> <span class="ot">TRUE</span>, <span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-8-1.png" width="720"></p>
</div>
<div id="visits-embeddings" class="section level2">
<h2 class="hasAnchor">
<a href="#visits-embeddings" class="anchor"></a>Visits embeddings</h2>
<p>Having the embeddings of terms, we can compute embeddings of visits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">visits_vectors &lt;-<span class="st"> </span><span class="kw"><a href="../reference/embed_list_visits.html">embed_list_visits</a></span>(inter_descriptions, exam_descriptions, inter_term_vectors, exam_term_vectors)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(visits_vectors[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, ])</code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">8834656</td>
<td align="right">0.0477718</td>
<td align="right">0.3416259</td>
<td align="right">0.6020780</td>
<td align="right">-0.0781046</td>
<td align="right">-0.0204286</td>
<td align="right">0.0743295</td>
<td align="right">-1.0640732</td>
<td align="right">0.1230616</td>
<td align="right">0.6152174</td>
<td align="right">0.1576910</td>
<td align="right">-0.1028008</td>
<td align="right">-0.2325897</td>
<td align="right">1.1068377</td>
<td align="right">-0.5566383</td>
<td align="right">0.2076700</td>
<td align="right">-0.9786025</td>
</tr>
<tr class="even">
<td align="left">8040952</td>
<td align="right">0.2859907</td>
<td align="right">0.1174086</td>
<td align="right">0.3410140</td>
<td align="right">0.2776366</td>
<td align="right">-0.0122754</td>
<td align="right">0.2678638</td>
<td align="right">0.0315066</td>
<td align="right">-0.1299221</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">1898742</td>
<td align="right">0.3009898</td>
<td align="right">0.1787937</td>
<td align="right">0.1587241</td>
<td align="right">0.2971205</td>
<td align="right">0.0419963</td>
<td align="right">0.3508933</td>
<td align="right">-0.0724837</td>
<td align="right">-0.2790734</td>
<td align="right">0.2270200</td>
<td align="right">1.0944763</td>
<td align="right">-0.0240037</td>
<td align="right">-0.1472944</td>
<td align="right">-0.0843081</td>
<td align="right">-0.3903938</td>
<td align="right">0.1661915</td>
<td align="right">-0.6838200</td>
</tr>
<tr class="even">
<td align="left">1919649</td>
<td align="right">0.2534906</td>
<td align="right">0.2786975</td>
<td align="right">0.3535578</td>
<td align="right">0.0419521</td>
<td align="right">0.2644723</td>
<td align="right">0.3065976</td>
<td align="right">-0.0985929</td>
<td align="right">-0.2633122</td>
<td align="right">-0.0936139</td>
<td align="right">0.1920622</td>
<td align="right">0.2664002</td>
<td align="right">-0.0359872</td>
<td align="right">0.6439745</td>
<td align="right">-0.5599459</td>
<td align="right">0.0993295</td>
<td align="right">-0.4749020</td>
</tr>
<tr class="odd">
<td align="left">8029957</td>
<td align="right">-0.1549230</td>
<td align="right">0.2923651</td>
<td align="right">-0.0546498</td>
<td align="right">-0.3406486</td>
<td align="right">0.0130945</td>
<td align="right">-0.0015723</td>
<td align="right">0.0035741</td>
<td align="right">0.2529395</td>
<td align="right">0.0093941</td>
<td align="right">0.4425416</td>
<td align="right">0.0029227</td>
<td align="right">-0.1906418</td>
<td align="right">0.0593670</td>
<td align="right">-0.3124548</td>
<td align="right">0.4095162</td>
<td align="right">-0.4421947</td>
</tr>
</tbody></table>
<p>And now we can visualize the visits on the plot and color by the doctors’ IDs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits_<span class="dv">1000</span>, <span class="dt">color_by =</span> <span class="st">"doctor"</span>,
                                <span class="dt">spec =</span> <span class="st">"medycyna rodzinna"</span>, <span class="dt">n_doctors =</span> <span class="dv">9</span>)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-10-1.png" width="720"></p>
<p>or by ICD-10 code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits_<span class="dv">1000</span>, <span class="dt">color_by =</span> <span class="st">"icd10"</span>,
                                <span class="dt">spec =</span> <span class="st">"medycyna rodzinna"</span>, <span class="dt">n_codes =</span> <span class="dv">5</span>)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-11-1.png" width="720"></p>
</div>
<div id="clustering" class="section level2">
<h2 class="hasAnchor">
<a href="#clustering" class="anchor"></a>Clustering</h2>
<p>On the visits’ embeddings we can run the k-means algorithm:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clusters &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cluster_visits.html">cluster_visits</a></span>(visits_vectors, visits_<span class="dv">1000</span>, <span class="dt">spec =</span> <span class="st">"medycyna rodzinna"</span>, <span class="dt">cluster_number =</span> <span class="dv">6</span>)</code></pre></div>
<p>and plot the clusters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_visit_embeddings.html">visualize_visit_embeddings</a></span>(visits_vectors, visits_<span class="dv">1000</span>, <span class="dt">color_by =</span> <span class="st">"cluster"</span>,
                                <span class="dt">spec =</span> <span class="st">"medycyna rodzinna"</span>, <span class="dt">clusters =</span> clusters)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-13-1.png" width="720"></p>
<p>For every cluster we can see the most frequent recommendations from chosen categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">recom &lt;-<span class="st"> </span><span class="kw"><a href="../reference/parse_data.html">parse_data</a></span>(recommendation_<span class="dv">1000</span>)
recom_descriptions &lt;-<span class="st"> </span>recom[[<span class="dv">2</span>]]

rec_tables &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_cluster_recommendations.html">get_cluster_recommendations</a></span>(recom_descriptions, clusters, <span class="dt">recom_table =</span> recom[[<span class="dv">1</span>]])
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(rec_tables[[<span class="dv">2</span>]])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">recommendation</th>
<th align="right">count</th>
<th align="right">frequency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">kontynuacja leków</td>
<td align="right">7</td>
<td align="right">0.6363636</td>
</tr>
<tr class="even">
<td align="left">kontynuacja leczenia</td>
<td align="right">4</td>
<td align="right">0.3636364</td>
</tr>
<tr class="odd">
<td align="left">kontrola lekarska</td>
<td align="right">1</td>
<td align="right">0.0909091</td>
</tr>
</tbody>
</table>
<p>or from all categories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rec_tables &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_cluster_recommendations.html">get_cluster_recommendations</a></span>(recom_descriptions, clusters, <span class="dt">category =</span> <span class="st">"all"</span>)
knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(rec_tables[[<span class="dv">2</span>]])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">recommendation</th>
<th align="right">count</th>
<th align="right">frequency</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">wieczorem</td>
<td align="right">11</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">11</td>
<td align="right">1.0000000</td>
</tr>
<tr class="odd">
<td align="left">konieczna kontrola lekarska</td>
<td align="right">10</td>
<td align="right">0.9090909</td>
</tr>
<tr class="even">
<td align="left">pogorszenie stanu zdrowia</td>
<td align="right">10</td>
<td align="right">0.9090909</td>
</tr>
<tr class="odd">
<td align="left">kontynuacja leków</td>
<td align="right">7</td>
<td align="right">0.6363636</td>
</tr>
<tr class="even">
<td align="left">kontynuacja leczenia</td>
<td align="right">4</td>
<td align="right">0.3636364</td>
</tr>
<tr class="odd">
<td align="left">kontrola lekarska</td>
<td align="right">1</td>
<td align="right">0.0909091</td>
</tr>
<tr class="even">
<td align="left">pogorszenie</td>
<td align="right">1</td>
<td align="right">0.0909091</td>
</tr>
<tr class="odd">
<td align="left">zdrowie</td>
<td align="right">1</td>
<td align="right">0.0909091</td>
</tr>
</tbody>
</table>
<p>If we have a new visit, we can assign it to the most appropriate cluster:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inter_descr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"ból głowy"</span>, <span class="st">"złe samopoczucie"</span>, <span class="st">"obniżony nastrój", sep = "</span>, <span class="st">")</span>
<span class="st">exam_descr &lt;- paste("</span>niskie ciśnienie<span class="st">", "</span>stan ogólny dobry<span class="st">", "</span>temperatura ciała<span class="st">", "</span>w normie<span class="st">",</span>
<span class="st">                    "</span>skierowanie<span class="st">", "</span>badanie neurologiczne<span class="st">", sep = "</span>, <span class="st">")</span>
<span class="st">visit_description &lt;- c(inter_descr, exam_descr)</span>
<span class="st">names(visit_description) &lt;- c("</span>inter<span class="st">", "</span>exam<span class="st">")</span>
<span class="st">cl &lt;- assign_visit_to_cluster(visit_description, clusters, inter_term_vectors, exam_term_vectors)</span>
<span class="st">cl</span>
<span class="st">#&gt; $cl</span>
<span class="st">#&gt; 6 </span>
<span class="st">#&gt; 6 </span>
<span class="st">#&gt; </span>
<span class="st">#&gt; $distances</span>
<span class="st">#&gt;          1          2          3          4          5          6 </span>
<span class="st">#&gt; 0.17024242 0.17358963 0.12008698 0.24265101 0.20167689 0.09500041</span></code></pre></div>
<p>As the last nice thing we can see the embeddings of ICD-10 codes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/visualize_icd10.html">visualize_icd10</a></span>(visits_vectors, visits_<span class="dv">1000</span>)</code></pre></div>
<p><img src="memr_files/figure-html/unnamed-chunk-17-1.png" width="720"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#medical-records-embeddings">Medical records embeddings</a></li>
      <li><a href="#example-datasets">Example datasets</a></li>
      <li><a href="#medical-terms-embeddings">Medical terms embeddings</a></li>
      <li><a href="#visits-embeddings">Visits embeddings</a></li>
      <li><a href="#clustering">Clustering</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Adam Gabriel Dobrakowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
